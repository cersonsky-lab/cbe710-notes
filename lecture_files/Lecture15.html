
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Free energy perturbation and thermodynamic integration &#8212; Advanced Thermodynamics for Chemical Engineers</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/defs.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture_files/Lecture15';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simulation Project (Due Monday, November 6, 2023)" href="../problems/simulation_project.html" />
    <link rel="prev" title="Umbrella Sampling" href="Lecture14B.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Advanced Thermodynamics for Chemical Engineers</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Class introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Before we get started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture1A.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture1B.html">Review of thermodynamics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical Mechanics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture2.html">Postulates of statistical mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture3.html">Application of the microcanonical ensemble: two-state system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture4.html">The canonical ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture5.html">Generalized ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture6.html">The ideal gas partition function</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture7.html">Application of independent subsystems: the Langmuir isotherm</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture8A.html">The Ising model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture8B.html">Mean-field theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture9A.html">Fluctuations and thermodynamic response functions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical Mechanics Problem Sets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_1/problem_set_1.html">Problem Set 1 (Due Wednesday, September 20, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_2/problem_set_2.html">Problem Set 2 (Due Wednesday, September 27, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_3/problem_set_3.html">Problem Set 3 (Due Monday, October 9, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/exam_1_practice.html">Practice Problems for Unit Exam</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Molecular Simulation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture9B.html">An introduction to molecular simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture10.html">Monte Carlo simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture11.html">Nuances of stochastic sampling in statistical ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture12A.html">Molecular dynamics simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture12B.html">Temperature and velocities in MD</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture13.html">Distribution of particles in states of matter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture14A.html">The potential of mean force</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture14B.html">Umbrella Sampling</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Free energy perturbation and thermodynamic integration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Molecular Simulation Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../problems/simulation_project.html">Simulation Project (Due Monday, November 6, 2023)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermodynamics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture16.html">Postulates of thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture17.html">Heat engines and possible processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture18.html">The Carnot Cycle and the Theorem of Clausius</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture19.html">The fundamental relation of thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture20.html">Legendre transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture21.html">Conditions of equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture22.html">Equilibrium in single-component systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture23.html">Phase diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture24.html">Fugacity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture25.html">Ideal mixtures</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture26.html">Non-ideal mixtures</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermodynamics Problem Sets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_4/problem_set_4.html">Problem Set 4 (Due Wednesday, November 22, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_5/problem_set_5.html">Problem Set 5 (Due Wednesday, November 29, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_6/problem_set_6.html">Problem Set 6 (Due Wednesday, December 6, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/exam_2_practice.html">Practice Problems for Unit Exam</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendices/notation.html">Additional Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/thermo_pot.html">Summary of thermodynamic potentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/expansion.html">Derivation of expansion rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/euler.html">Derivation of Euler integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/references.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lecture_files/Lecture15.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Free energy perturbation and thermodynamic integration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-readings-for-the-enthusiast">Additional Readings for the Enthusiast</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-for-today-s-lecture">Goals for Today’s Lecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#free-energy-perturbation">Free energy perturbation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-probabilities-of-energy-differences-between-systems">Determining the probabilities of energy differences between systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-free-energy-difference">Computing the free energy difference</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thermodynamic-integration">Thermodynamic integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#link-to-shared-notes">Link to Shared Notes</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="free-energy-perturbation-and-thermodynamic-integration">
<h1>Free energy perturbation and thermodynamic integration<a class="headerlink" href="#free-energy-perturbation-and-thermodynamic-integration" title="Link to this heading">#</a></h1>
<section id="additional-readings-for-the-enthusiast">
<h2>Additional Readings for the Enthusiast<a class="headerlink" href="#additional-readings-for-the-enthusiast" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><span id="id1">Frenkel and Smit [<a class="reference internal" href="../appendices/references.html#id5" title="Daan Frenkel and Berend Smit. Understanding molecular simulation: from algorithms to applications. Number 1 in Computational science series. Academic Press, San Diego, 2nd ed edition, 2002. ISBN 978-0-12-267351-1. URL: https://www.eng.uc.edu/~beaucag/Classes/AdvancedMaterialsThermodynamics/Books/%5BComputational%20science%20(San%20Diego,%20Calif.)%5D%20Daan%20Frenkel_%20Berend%20Smit%20-%20Understanding%20molecular%20simulation%20_%20from%20algorithms%20to%20applications%20(2002,%20Academic%20Press%20)%20-%20libgen.lc.pdf.">2</a>]</span> Ch. 7.1</p></li>
</ul>
</section>
<section id="goals-for-today-s-lecture">
<h2>Goals for Today’s Lecture<a class="headerlink" href="#goals-for-today-s-lecture" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Determine the free energy difference for two systems with different potential energy functions</p></li>
</ul>
</section>
<section id="free-energy-perturbation">
<h2>Free energy perturbation<a class="headerlink" href="#free-energy-perturbation" title="Link to this heading">#</a></h2>
<p>So far, we have defined the potential of mean force as the change in the
free energy of a system during a process in which particle coordinates
follow some predefined reaction coordinate, and hence the overall system
potential energy function is unchanged. Computing the potential of mean
force associated with different regions of phase space is useful for
calculating the magnitude of energy barriers and identifying local
minima. However, we might also ask how to calculate the change in free
energy between two systems with different potential energy functions
entirely. Finding an algorithm to accomplish this would also be useful
in applications other than calculating a PMF along a reaction
coordinate, such as calculating the free energy change associated with
mutating the chemical identities of molecules in a simulation. This leads to</p>
<dl class="simple glossary">
<dt id="term-free-energy-perturbation"><a class="reference external" href="https://en.wikipedia.org/wiki/Free_energy_perturbation#:~:text=Free%20energy%20perturbation%20(FEP)%20is,Zwanzig%20in%201954.">free energy perturbation</a><a class="headerlink" href="#term-free-energy-perturbation" title="Link to this term">#</a></dt><dd><p>a method to compute the free energy difference between two systems with different
partition functions</p>
</dd>
</dl>
<p>For this calculation, we will first define two partition functions,
<span class="math notranslate nohighlight">\(Z_0\)</span> and <span class="math notranslate nohighlight">\(Z_1\)</span>, corresponding to two different systems with potential
energy functions <span class="math notranslate nohighlight">\(E_0(\mathbf{r}^N)\)</span> and <span class="math notranslate nohighlight">\(E_1(\mathbf{r}^N)\)</span>. Note that
while the potential energy functions are different, we assume that the
set of possible values of <span class="math notranslate nohighlight">\(\mathbf{r}^N\)</span> are the same (<em>i.e.</em>, both
systems access the same phase space).</p>
<p>For example, one could imagine
computing the free energy difference between an ideal gas and a
non-ideal gas with the same number of particles, with the interactions
associated with the non-ideal gas leading to a different potential
energy function. The Helmholtz free energy change for transforming from
system 0 to 1 is then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\Delta F &amp;= F_1 - F_0  \\ 
&amp;= -k_BT \ln Z_1/Z_0 \\
\end{aligned}\end{split}\]</div>
<p>How do we compute this?</p>
<section id="determining-the-probabilities-of-energy-differences-between-systems">
<h3>Determining the probabilities of energy differences between systems<a class="headerlink" href="#determining-the-probabilities-of-energy-differences-between-systems" title="Link to this heading">#</a></h3>
<p>We then define <span class="math notranslate nohighlight">\(p_1(\Delta E')\)</span> as the probability distribution for the
energy difference
<span class="math notranslate nohighlight">\(\Delta E(\textbf{r}^N) = E_1(\mathbf{r}^N) - E_0(\mathbf{r}^N)\)</span> with
configurations sampled using <span class="math notranslate nohighlight">\(E_1\)</span>.</p>
<p>In other words, we can imagine
generating a large number of configurations using <span class="math notranslate nohighlight">\(E_1\)</span>,
calculating the energy of those configurations
according to both <span class="math notranslate nohighlight">\(E_1\)</span> and <span class="math notranslate nohighlight">\(E_0\)</span>, then finding the probability of
identifying a particular energy difference <span class="math notranslate nohighlight">\(\Delta E'\)</span>. Similarly,
<span class="math notranslate nohighlight">\(p_0(\Delta E')\)</span> is the probability density for the same energy
difference with configurations sampled using <span class="math notranslate nohighlight">\(E_0\)</span>. We then write:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
p_1(\Delta E') &amp;= \frac{\int d\mathbf{r}^N \exp \left [ -\beta E_1(\mathbf{r}^N) \right ] \delta(\Delta E(\textbf{r}^N) - \Delta E')}{Z_1}  \\
&amp;= \frac{\int d\mathbf{r}^N \exp \left [ -\beta (E_0(\mathbf{r}^N) + \Delta E') \right ] \delta(\Delta E(\textbf{r}^N) - \Delta E')}{Z_1}  \\
&amp;= \frac{\int d\mathbf{r}^N \exp \left [ -\beta E_0(\mathbf{r}^N) \right ] \exp \left [ -\beta \Delta E' \right ] \delta(\Delta E(\textbf{r}^N) - \Delta E')}{Z_1}
\end{aligned}\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\Delta E'\)</span> is a fixed value that is not a function of
<span class="math notranslate nohighlight">\(\mathbf{r}^N\)</span> and the delta function eliminates all other possible
values of <span class="math notranslate nohighlight">\(\Delta E(\textbf{r}^N)\)</span>, so in the second line we can define
<span class="math notranslate nohighlight">\(E_1(\textbf{r}^N) = E_0(\textbf{r}^N) + \Delta E'\)</span> and in the third
line <span class="math notranslate nohighlight">\(\exp \left [ -\beta \Delta E' \right ]\)</span> can be removed from the
integral. We can now multiply the numerator and demoninator by <span class="math notranslate nohighlight">\(Z_0\)</span> to
obtain:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
p_1(\Delta E') &amp;= \exp \left [ -\beta \Delta E' \right ] \frac{\int d\mathbf{r}^N \exp \left [ -\beta E_0(\mathbf{r}^N) \right ]  \delta(\Delta E(\textbf{r}^N) - \Delta E')}{Z_1}   \\
&amp;= \frac{Z_0}{Z_1} \exp \left [ -\beta \Delta E' \right ] \frac{\int d\mathbf{r}^N \exp \left [ -\beta E_0(\mathbf{r}^N) \right ]  \delta(\Delta E(\textbf{r}^N) - \Delta E')}{Z_0}   \\
&amp;= \frac{Z_0}{Z_1} \exp \left [ -\beta \Delta E' \right ] p_0(\Delta E')
\end{aligned}\end{split}\]</div>
<p>Huzzah! With the term of <span class="math notranslate nohighlight">\(\frac{Z_0}{Z_1}\)</span>, we have a way to relate this to our free energy difference.</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{Z_0}{Z_1} &amp; = \frac{p_1(\Delta E')}{ p_0(\Delta E')}\exp \left [\beta \Delta E' \right ]
\end{aligned}
\]</div>
<p>From this equation alone we can see that calculating the two probability
densities from simulations in both ensembles would allow for the
calculation of the free energy change <span class="math notranslate nohighlight">\(\Delta F\)</span>.</p>
</section>
<section id="computing-the-free-energy-difference">
<h3>Computing the free energy difference<a class="headerlink" href="#computing-the-free-energy-difference" title="Link to this heading">#</a></h3>
<p>We can take the log of both sides to estimate the free energy difference
using <span class="math notranslate nohighlight">\(\Delta F = -kT \ln Z_1/Z_0\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\beta\Delta F &amp; = \log p_1(\Delta E') - \log p_0(\Delta E') + \beta \Delta E'
\end{aligned}
\]</div>
<p>For integration purposes, this is easier to write as</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
p_1(\Delta E')&amp;= p_0 (\Delta E') \exp \left [\beta \left ( \Delta F - \Delta E'\right )\right ]
\end{aligned}\]</div>
<p>Finally, we can
integrate both sides over all possible values of <span class="math notranslate nohighlight">\(\Delta E'\)</span> to yield a
more concise expression:</p>
<div class="math notranslate nohighlight" id="equation-app-a-fep-eq">
<span class="eqno">(28)<a class="headerlink" href="#equation-app-a-fep-eq" title="Link to this equation">#</a></span>\[\begin{split}\int_{-\infty}^{\infty} d\Delta E' p_1(\Delta E') &amp;= \exp (\beta \Delta F)\int_{-\infty}^{\infty} d\Delta E' p_0(\Delta E') \exp (-\beta \Delta E')\\
1 &amp;= \exp (\beta \Delta F) \langle \exp \left [ - \beta \Delta E \right ] \rangle_0\\
\exp \left [ -\beta \Delta F \right ]  &amp;= \langle \exp \left [ - \beta \Delta E \right ] \rangle_0\end{split}\]</div>
<p>Here, we integrate the probability distribution for <span class="math notranslate nohighlight">\(\Delta E'\)</span> over all
possible energy differences sampled in system 1; since the probability
distributions is normalized, this just equals 1. The value <span class="math notranslate nohighlight">\(\Delta F\)</span> is
independent of <span class="math notranslate nohighlight">\(\Delta E'\)</span> so it can be removed from the integral on the
right hand side, which then is equal to the ensemble average value of
the exponential of <span class="math notranslate nohighlight">\(\Delta E'\)</span>, yielding the final expression. Note
again that this ensemble average is sampled using the energy function of
system 0.</p>
<p>The final free energy perturbation expression relates the free energy
change for transforming from system 0 to system 1 to the ensemble
average of the energy change for this transformation for configurations
sampled from <span class="math notranslate nohighlight">\(Z_0\)</span>. Free energy perturbation can be used directly in
molecular simulations by defining system 0 and 1, generating
configurations according to the potential energy function of system 0,
calculating the energy of the same configuration calculated using both
<span class="math notranslate nohighlight">\(E_1\)</span> and <span class="math notranslate nohighlight">\(E_0\)</span>, then averaging <span class="math notranslate nohighlight">\(E_1 - E_0\)</span> to get <span class="math notranslate nohighlight">\(\Delta F\)</span> according
to eq. <a class="reference internal" href="#equation-app-a-fep-eq">(28)</a>. Note that there are <em>no</em> constraints on what
the potential energy functions of system <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(1\)</span> can be, so it is
possible to use this approach to completely change the chemical identify
of molecules during a simulation and measure the corresponding free
energy change. Such transformations are called <a class="reference external" href="http://alchemistry.org/wiki/Main_Page">alchemical free energy
calculations</a>.</p>
<p>Alchemical free energy calculations are often used to compute the free
energy difference between two states that have no clear reaction
coordinate connecting them, and for which only differences in energy
(and not complete free energy pathways) are necessary. A typical example
is in the design of drug inhibitors to bind proteins - free energy
perturbation can be used to calculate the free energy change between a
molecule bound to a receptor and a slightly different molecule bound to
the same receptor to quantify relative binding affinities.
Alternatively, the same technique could be used to calculate the
absolute free energy of binding by defining a difference in free energy
between the bound drug molecule and a drug molecule free in solution.</p>
</section>
</section>
<section id="thermodynamic-integration">
<h2>Thermodynamic integration<a class="headerlink" href="#thermodynamic-integration" title="Link to this heading">#</a></h2>
<p>We will discuss one final
method to close our discussion of molecular simulations. The final
technique we will discuss is similar in spirit to free energy
perturbation, in that it involves the calculation of the change in free
energy between two systems with distinct potential energy functions. In
the case of <a class="reference external" href="https://en.wikipedia.org/wiki/Thermodynamic_integration">thermodynamic integration</a>,
we will explicitly define a
linear interpolation between the potential energy functions for the two
systems via a coupling parameter, <span class="math notranslate nohighlight">\(\lambda\)</span>. We write:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
E_\lambda(\textbf{r}^N) &amp;= (1-\lambda)E_0(\textbf{r}^N) + \lambda E_1(\textbf{r}^N) \\
&amp;= E_0(\textbf{r}^N) + \lambda[E_1(\textbf{r}^N) - E_0(\textbf{r}^N]
\end{aligned}\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(E_0(\textbf{r}^N)\)</span> and <span class="math notranslate nohighlight">\(E_1(\textbf{r}^N)\)</span> refer to the two
reference states, and the value of <span class="math notranslate nohighlight">\(\lambda\)</span> interpolates the system
potential energy function between that of <span class="math notranslate nohighlight">\(E_0\)</span> for <span class="math notranslate nohighlight">\(\lambda = 0\)</span> and
<span class="math notranslate nohighlight">\(E_1\)</span> for <span class="math notranslate nohighlight">\(\lambda = 1\)</span>. We can now write the derivative of the
Helmholtz free energy with respect to <span class="math notranslate nohighlight">\(\lambda\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\left ( \frac{\partial F(\lambda)}{\partial \lambda}\right ) &amp;=-k_BT \frac{\partial }{\partial \lambda} \ln Z(\lambda) \\
&amp;= -\frac{k_B T}{Z(\lambda)} \frac{\partial Z(\lambda)}{\partial \lambda} \\
&amp;= -\frac{k_BT}{Z(\lambda)} \frac{\partial }{\partial \lambda} \int d\textbf{r}^N \exp \left [ -\beta E_\lambda(\textbf{r}^N) \right ] \\
&amp;= \frac{\int d\textbf{r}^N \left ( \partial E_\lambda(\textbf{r}^N) / \partial \lambda \right ) \exp \left [ -\beta E_\lambda(\textbf{r}^N) \right ] }{Z(\lambda)} \\
&amp;= \left \langle \frac{\partial E_\lambda(\textbf{r}^N)}{\partial \lambda}\right \rangle_\lambda
\end{aligned}\end{split}\]</div>
<p>This expression shows that we can relate the change in the free energy
of the system with respect to the coupling parameter to an ensemble
average of that derivative sampled from an ensemble at a particular
value of <span class="math notranslate nohighlight">\(\lambda\)</span>, as indicated by the subscript in the angular
brackets. We can then calculate the complete free energy difference
between system 0 and 1 by:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
F(\lambda = 1) - F(\lambda = 0) = \int_{\lambda = 0}^{\lambda = 1} \left \langle \frac{\partial E_\lambda(\textbf{r}^N)}{\partial \lambda}\right \rangle_\lambda d\lambda
\end{aligned}\]</div>
<p>This final integral is why the technique is called <em>thermodynamic
integration</em>. In practice, this integral is evaluated by choosing
several discrete values of <span class="math notranslate nohighlight">\(\lambda\)</span>, sampling particle configurations
according to the potential energy function <span class="math notranslate nohighlight">\(E_\lambda\)</span>, and for each
sampled configuration calculating the energy using
<span class="math notranslate nohighlight">\(E_{\lambda \pm d\lambda}\)</span> where <span class="math notranslate nohighlight">\(d\lambda\)</span> is some small interval. The
derivative is approximated from a finite difference between these three
values and used to calculate the ensemble average. The integral is then
evaluated by quadrature. This approach does not necessarily require a
linear coupling parameter, although in practice this is a simple method
that is commonly used. It should be noted that the coupling parameter
approach, and the division of the thermodynamic integral into multiple
discrete values of <span class="math notranslate nohighlight">\(\lambda\)</span>, can also be used with free energy
perturbation to improve convergence.</p>
<p>Given the similarities to free energy perturbation, thermodynamic
integration is often used for similar systems. It has been used
extensively in calculating the phase behavior of self-assembled
mixtures, in part because thermodynamic integration can be used to
calculate the free energy between two phases that differ in their
thermodynamic properties, such as temperature, via appropriate selection
of a coupling parameter (as opposed to biasing their potential
energies).</p>
</section>
<section id="link-to-shared-notes">
<h2><a class="reference external" href="https://docs.google.com/document/d/1Tsa3jGWZJTySrWt0IZWdYpyh-ILLOko_/edit?usp=drive_link">Link to Shared Notes</a><a class="headerlink" href="#link-to-shared-notes" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lecture_files"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lecture14B.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Umbrella Sampling</p>
      </div>
    </a>
    <a class="right-next"
       href="../problems/simulation_project.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Simulation Project (Due Monday, November 6, 2023)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-readings-for-the-enthusiast">Additional Readings for the Enthusiast</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-for-today-s-lecture">Goals for Today’s Lecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#free-energy-perturbation">Free energy perturbation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-probabilities-of-energy-differences-between-systems">Determining the probabilities of energy differences between systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-free-energy-difference">Computing the free energy difference</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thermodynamic-integration">Thermodynamic integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#link-to-shared-notes">Link to Shared Notes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Reid van Lehn, Matt Gebbie, Rose K. Cersonsky
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>