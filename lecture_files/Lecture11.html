

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nuances of stochastic sampling in statistical ensembles &#8212; Advanced Thermodynamics for Chemical Engineers</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/defs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture_files/Lecture11';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Molecular dynamics simulations" href="Lecture12A.html" />
    <link rel="prev" title="Monte Carlo simulations" href="Lecture10.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    <p class="title logo__title">Advanced Thermodynamics for Chemical Engineers</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Class introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical Mechanics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture1A.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture1B.html">Review of thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture2.html">Postulates of statistical mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture3.html">Application of the microcanonical ensemble: two-state system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture4.html">The canonical ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture5.html">Generalized ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture6.html">The ideal gas partition function</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture7.html">Application of independent subsystems: the Langmuir isotherm</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture8A.html">The Ising model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture8B.html">Mean-field theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture9A.html">Fluctuations and thermodynamic response functions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Molecular Simulation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture9B.html">An introduction to molecular simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture10.html">Monte Carlo simulations</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Nuances of stochastic sampling in statistical ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture12A.html">Molecular dynamics simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture12B.html">Temperature and velocities in MD</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture13.html">Distribution of particles in states of matter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture14.html">The potential of mean force</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture15.html">Free energy perturbation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Problem Sets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_1/problem_set_1.html">Problem Set 1 (Due Tuesday, September 19, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_2/problem_set_2.html">Problem Set 2 (Due Thursday, September 28, 2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/ps_3/problem_set_3.html">Problem Set 3 (Due Thursday, October 10, 2023)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../references.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lecture_files/Lecture11.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nuances of stochastic sampling in statistical ensembles</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-readings-for-the-enthusiast">Additional Readings for the Enthusiast</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-for-today-s-lecture">Goals for Today’s Lecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-sampling">Importance sampling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-chains">Markov chains</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-balance">Detailed balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-hastings-algorithm">The Metropolis-Hastings algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#link-to-shared-notes">Link to Shared Notes</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nuances-of-stochastic-sampling-in-statistical-ensembles">
<h1>Nuances of stochastic sampling in statistical ensembles<a class="headerlink" href="#nuances-of-stochastic-sampling-in-statistical-ensembles" title="Permalink to this headline">#</a></h1>
<section id="additional-readings-for-the-enthusiast">
<h2>Additional Readings for the Enthusiast<a class="headerlink" href="#additional-readings-for-the-enthusiast" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><span id="id1">Frenkel and Smit [<a class="reference internal" href="../references.html#id5" title="Daan Frenkel and Berend Smit. Understanding molecular simulation: from algorithms to applications. Number 1 in Computational science series. Academic Press, San Diego, 2nd ed edition, 2002. ISBN 978-0-12-267351-1. URL: https://www.eng.uc.edu/~beaucag/Classes/AdvancedMaterialsThermodynamics/Books/%5BComputational%20science%20(San%20Diego,%20Calif.)%5D%20Daan%20Frenkel_%20Berend%20Smit%20-%20Understanding%20molecular%20simulation%20_%20from%20algorithms%20to%20applications%20(2002,%20Academic%20Press%20)%20-%20libgen.lc.pdf.">2</a>]</span>, Ch. 3</p></li>
</ul>
</section>
<section id="goals-for-today-s-lecture">
<h2>Goals for Today’s Lecture<a class="headerlink" href="#goals-for-today-s-lecture" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Understand the need for non-random sampling in statistical ensemble</p></li>
<li><p>Describe Markov chains, importance sampling, detailed balance</p></li>
<li><p>Derive the acceptance criteria for the Metropolis-Hasting algorithm</p></li>
</ul>
</section>
<section id="importance-sampling">
<h2>Importance sampling<a class="headerlink" href="#importance-sampling" title="Permalink to this headline">#</a></h2>
<p>One major hitch up to this point has been our probability distribution –
in the area example, we directly sampled this by selecting points at random.
In our determinate equations, we had it predetermined.</p>
<p>To evaluate ensemble averages from the canonical ensemble, we can choose
our probability density, <span class="math notranslate nohighlight">\(p(x)\)</span>,
to maximize the likelihood of sampling configurations that
contribute meaningfully to the calculation of the ensemble average. This
is the essence of</p>
<dl class="glossary simple">
<dt id="term-importance-sampling">importance sampling<a class="headerlink" href="#term-importance-sampling" title="Permalink to this term">#</a></dt><dd><p>sampling from a distribution of states in order to maximize the
information gained from each observation</p>
</dd>
</dl>
<p>First, let’s recall that the probability of finding the system in a given microstate of the
canonical ensemble, <span class="math notranslate nohighlight">\(p(\textbf{r}^N)_{NVT}\)</span>, is related to the Boltzmann
factor for that state normalized by the partition function. We can then
write:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
p(\textbf{r}^N)_{NVT} &amp;= \frac{\exp \left [-\beta E(\mathbf{r}^N)\right ]}{Z} \\
\langle Y \rangle_{NVT} &amp;= \int d \mathbf{r}^N p(\textbf{r}^N)_{NVT}  Y(\mathbf{r}^N) 
\end{aligned}\end{split}\]</div>
<p>The ensemble average then has the same form as <span class="math notranslate nohighlight">\(F = \int_a^b f(x) dx\)</span> if
we let
<span class="math notranslate nohighlight">\(f(x) = p(\mathbf{r}^N)_{NVT} Y(\mathbf{r}^N)\)</span>. Following the reasoning
above, we can then approximate <span class="math notranslate nohighlight">\(\langle Y \rangle_{NVT}\)</span> by:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\langle Y \rangle_{NVT} = \left \langle \frac{ p(\mathbf{r}^N)_{NVT} Y(\mathbf{r}^N) }{p(\mathbf{r}^N)} \right \rangle_{\textrm{trials}}
\end{aligned}\]</div>
<p>From this expression, we see that if we select trials according to the
probability distribution <span class="math notranslate nohighlight">\(p(\mathbf{r}^N) = p(\mathbf{r}^N)_{NVT}\)</span>, then
we get:</p>
<div class="math notranslate nohighlight">
\[\langle Y \rangle_{NVT}  = \langle Y \rangle_{\textrm{trials}} \label{ensemble_average_mc}\]</div>
<p>Thus, we choose configurations in our ensemble according to the
canonical ensemble probability distribution, in which case the
ensemble-average value of <span class="math notranslate nohighlight">\(Y\)</span> can be estimated by sampling
configurations according to their Boltzmann weight. Finally, we note
that we just need to know the probability of sampling a configuration -
we do not necessarily need an expression for the partition function
itself.</p>
<p>Our problem then boils down to: how do we select states according to the
correct probability distribution without knowing the value of the
partition function?</p>
</section>
<section id="markov-chains">
<h2>Markov chains<a class="headerlink" href="#markov-chains" title="Permalink to this headline">#</a></h2>
<p>To do so, we will generate a</p>
<dl class="glossary simple">
<dt id="term-Markov-chain-of-states"><a class="reference external" href="https://en.wikipedia.org/wiki/Markov_chain">Markov chain of states</a><a class="headerlink" href="#term-Markov-chain-of-states" title="Permalink to this term">#</a></dt><dd><p>a sequence of states that is determined one step at a time based upon
the probability moving from one state to another</p>
</dd>
</dl>
<p>A Markov chain satisfies the following two conditions:</p>
<ul class="simple">
<li><p>Each state generated belongs to a finite set of possible outcomes
called the <em>state space</em>. The statistical mechanical analogue to this
statement is to say that each microstate generated belongs to a
finite ensemble. We can denote each possible state by
<span class="math notranslate nohighlight">\(\mathbf{r}_1^N, \mathbf{r}_2^N, \mathbf{r}_3^N, \dots\)</span> for the
enormous set of possible microstates within the canonical ensemble
that we are sampling. For the canonical ensemble, this state space
is equal to <span class="math notranslate nohighlight">\(V^N\)</span>, the accessible phase space.</p></li>
<li><p>The probability of sampling state <span class="math notranslate nohighlight">\(i+1\)</span> in the sequence of states
sampled depends only on state <span class="math notranslate nohighlight">\(i\)</span>, and not on previous states in the
chain.</p></li>
</ul>
<p>Since the likelihood of sampling a new state is only related to what
current state we are in, we can define a transition probability,
<span class="math notranslate nohighlight">\(\Pi(m\rightarrow n)\)</span>, which defines the likelihood of transitioning
from state <span class="math notranslate nohighlight">\(m\)</span> to state <span class="math notranslate nohighlight">\(n\)</span>. We can then imagine an algorithm in which
we start in some state <span class="math notranslate nohighlight">\(m\)</span> then transition to a new state <span class="math notranslate nohighlight">\(n\)</span> with a
probability given by <span class="math notranslate nohighlight">\(\Pi(m\rightarrow n)\)</span> and repeat this for a large
number of trials.</p>
<p><img alt="image" src="../_images/fig_11_1-01.png" /></p>
<p>If we do this an infinite number of times, then the
state <span class="math notranslate nohighlight">\(m\)</span> will appear with an overall probability given by <span class="math notranslate nohighlight">\(p(m)\)</span>, where
<span class="math notranslate nohighlight">\(p(m)\)</span> is the <em>limiting</em> probability distribution that does not depend
on any of the other states (unlike the transition probability). When
sampling from the canonical ensemble, then, we want <span class="math notranslate nohighlight">\(p(m)\)</span> to equal
<span class="math notranslate nohighlight">\(p(\mathbf{r}_m^N)_{NVT}\)</span> - that is, the likelihood of sampling state
<span class="math notranslate nohighlight">\(m\)</span> if we take enough states from our Markov chain is equal to the
probability of sampling that state according to the canonical ensemble
distribution function. Thus, we need to find an expression for the
transition probability, <span class="math notranslate nohighlight">\(\Pi\)</span>, that yields this correct limiting
distribution.</p>
</section>
<section id="detailed-balance">
<h2>Detailed balance<a class="headerlink" href="#detailed-balance" title="Permalink to this headline">#</a></h2>
<p>At equilibrium, the probability of finding the system in a configuration
<span class="math notranslate nohighlight">\(\mathbf{r}_m^N\)</span> must be stationary, meaning that the probability
distribution of the canonical ensemble is invariant with time (this is a
consequence of ergodicity) and is equal to the limiting distribution of
our Markov chain. If we think about a Markov chain as a very large
sequence of states, then for the probability of a particular state to be
stationary, the number of transitions into that state must be the same
as the number of transitions out of it.</p>
<p>Think of this like a mass
balance in transport - the flux into a particular state is equal to the
flux out of it, otherwise we would “accumulate” probability for that
state. Therefore, it must be the case that in any given Markov chain the
number of trials that generate new states from a particular state must
be equal to the total number of trials from all other states that
generate the original configuration.</p>
<p>If we write the probability of
transitioning from some configuration <span class="math notranslate nohighlight">\(\mathbf{r}_m^N\)</span> to
<span class="math notranslate nohighlight">\(\mathbf{r}_n^N\)</span> as <span class="math notranslate nohighlight">\(\Pi(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span> and
the probability of being in state <span class="math notranslate nohighlight">\(\mathbf{r}_m^N\)</span> as
<span class="math notranslate nohighlight">\(p(\mathbf{r}_m^N)\)</span>, then we can fulfill the condition that
<span class="math notranslate nohighlight">\(p(\mathbf{r}_m^N)\)</span> is stationary by imposing the condition of</p>
<dl class="glossary">
<dt id="term-detailed-balance">detailed balance<a class="headerlink" href="#term-detailed-balance" title="Permalink to this term">#</a></dt><dd><div class="math notranslate nohighlight">
\[p(\mathbf{r}_m^N) \Pi(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) = p(\mathbf{r}_n^N) \Pi(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N)\]</div>
</dd>
</dl>
<p>We can rearrange this expression to write:</p>
<div class="math notranslate nohighlight">
\[\frac{p(\mathbf{r}_m^N)}{p(\mathbf{r}_n^N)}  = \frac{ \Pi(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N)}{\Pi(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)}\]</div>
<p>Writing detailed balance in this form more clearly shows the consequence
of this definition - if the probability of state <span class="math notranslate nohighlight">\(m\)</span>,
<span class="math notranslate nohighlight">\(p(\mathbf{r}_m^N)\)</span>, is 10 times larger than the probability of state
<span class="math notranslate nohighlight">\(n\)</span>, then this expression says that there will be 10 times more
transitions from state <span class="math notranslate nohighlight">\(n\)</span> to <span class="math notranslate nohighlight">\(m\)</span> than transitions from <span class="math notranslate nohighlight">\(m\)</span> to <span class="math notranslate nohighlight">\(n\)</span>,
agreeing with expectations. Enforcing this condition for all possible
pairs of states guarantees that the number of transitions into and out
of each state is equal if an infinite number of transitions are
attempted (detailed balance is actually an overly stringent criterion -
we could achieve the same properties while enforcing a less stringent
relationship between transition probabilities, but that is outside the
scope of this class).</p>
<p>If a system obeys detailed balance, then the Markov chain must reach a
stationary probability distribution which is necessarily true for any
equilibrium system.</p>
</section>
<section id="the-metropolis-hastings-algorithm">
<h2>The Metropolis-Hastings algorithm<a class="headerlink" href="#the-metropolis-hastings-algorithm" title="Permalink to this headline">#</a></h2>
<p>Having defined the principle of detailed balance, we
can now apply this to a particular Markov chain that samples states
within the canonical ensemble by following the</p>
<dl class="glossary simple">
<dt id="term-Metropolis-Hastings-algorithm"><a class="reference external" href="https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings algorithm</a><a class="headerlink" href="#term-Metropolis-Hastings-algorithm" title="Permalink to this term">#</a></dt><dd><p>Also known as the “Metropolis algorithm”. An algorithm that samples
states using acceptance criteria based upon transition probabilities.</p>
</dd>
</dl>
<p>The key aspect of the Metropolis algorithm is to further divide the
transition probability,
<span class="math notranslate nohighlight">\(\Pi(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span>, into two terms - the
probability of generating a new trial state,
<span class="math notranslate nohighlight">\(g(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span>, and the probability of
accepting the new trial state,
<span class="math notranslate nohighlight">\(\alpha (\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\Pi(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) = g(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) \alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\]</div>
<div class="admonition-show-that-in-the-canonical-ensemble-frac-alpha-mathbf-r-m-n-rightarrow-mathbf-r-n-n-alpha-mathbf-r-n-n-rightarrow-mathbf-r-m-n-exp-left-beta-left-e-mathbf-r-n-n-e-mathbf-r-m-n-right-right admonition">
<p class="admonition-title">Show that, in the canonical ensemble, <span class="math notranslate nohighlight">\(\frac{\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)}{\alpha(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N)} = \exp \left \{ -\beta \left [ E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) \right ] \right \}\)</span>.</p>
<details><summary> Show derivation </summary>
<p>Given the preceding definition, the equation for detailed balance can then be rewritten as:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{g(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) \alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)}{g(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N) \alpha(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N )} &amp;= \frac{p(\mathbf{r}_n^N)}{p(\mathbf{r}_m^N)}
\end{aligned}\]</div>
<p>Now, we can connect this expression explicitly to the canonical
ensemble. In the canonical ensemble, the probability of finding a
particular state <span class="math notranslate nohighlight">\(m\)</span> is related to that state’s Boltzmann weight, so we
can write:</p>
<div class="math notranslate nohighlight">
\[p(\mathbf{r}_m^N)_{NVT} = \frac{\exp \left [ -\beta E(\mathbf{r}_m^N) \right ]}{Z}\]</div>
<p>Next, we assume that the probability <span class="math notranslate nohighlight">\(g\)</span> for generating trial moves is
symmetric, and then write that
<span class="math notranslate nohighlight">\(g(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) = g(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N)\)</span>.
We can assume this because in general we can <strong>arbitrarily</strong> choose a
function for <span class="math notranslate nohighlight">\(g\)</span> as long as the detailed balance condition is satisfied.
Combining these expressions, we then write:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{g(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) \alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)}{g(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N) \alpha(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N )} &amp;= \frac{p(\mathbf{r}_n^N)_{NVT}}{p(\mathbf{r}_m^N)_{NVT}} \\
\frac{\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)}{\alpha(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N)} &amp;= \exp \left \{ -\beta \left [ E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) \right ] \right \}
\end{aligned}\end{split}\]</div>
</details>
</div>
<p>This equation stipulates the conditions on the
acceptance condition,
<span class="math notranslate nohighlight">\(\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span>, that leads to
correct Boltzmann-weighted sampling of configurations in the canonical
ensemble. Importantly, the partition function drops out of this
expression, resolving the issue of being unable to calculate the
partition function explicitly. In principle, several choices of the
acceptance condition could fulfill the conditions imposed detailed
balance; the choice used in the original derivation of the Metropolis
algorithm is:</p>
<div class="math notranslate nohighlight" id="equation-app-a-acceptance">
<span class="eqno">(23)<a class="headerlink" href="#equation-app-a-acceptance" title="Permalink to this equation">#</a></span>\[\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) = \text{min} \left ( 1, \exp \left \{ -\beta \left [ E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) \right ] \right \} \right )\]</div>
<p>which fulfills our earlier condition.. This is apparent if we consider
the case where <span class="math notranslate nohighlight">\(p(\mathbf{r}_n^N) &lt; p(\mathbf{r}_m^N)\)</span>, then:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) &gt; 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\exp \left \{ -\beta \left [ E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) \right ] \right \} &lt; 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N) = \exp \left \{ -\beta \left [ E(\mathbf{r}_n^N) - E(\mathbf{r}_m^N) \right ] \right \}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha(\mathbf{r}_n^N \rightarrow \mathbf{r}_m^N) = 1\)</span></p></li>
</ul>
<div class="admonition-if-the-proposed-state-has-a-lower-energy-than-our-current-one-what-is-the-probability-we-will-accept-the-transition-move admonition">
<p class="admonition-title">If the proposed state has a lower energy than our current one, what is the probability we will accept the transition move?</p>
<details><summary> Click for answer </summary>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$\pi=1$. All transitions in which the system
energy is lowered are automatically accepted.
</pre></div>
</div>
</details>
</div>
<p>It is possible for
the system to stay in the same state; that is:</p>
<div class="math notranslate nohighlight">
\[\Pi(\mathbf{r}_m \rightarrow \mathbf{r}_m) = 1 - \sum_{n\ne m} \Pi(\mathbf{r}_m \rightarrow \mathbf{r}_n)\]</div>
<p>Any given Markov chain generated using the Metropolis Monte Carlo
algorithm can thus have many consecutive identical states, particularly
if the system reaches a local energy minimum.</p>
<p>Based on this derivation, the Metropolis Monte Carlo algorithm for
correctly sampling states from the canonical ensemble consists of the
following steps (given in <a class="reference internal" href="../problems/ps_2/problem_set_2.html"><span class="doc std std-doc">Problem Set 2</span></a>):</p>
<ol class="arabic simple">
<li><p>Assume the system is in a configuration, <span class="math notranslate nohighlight">\(\mathbf{r}_m^N\)</span>, which is
state <span class="math notranslate nohighlight">\(i\)</span> in a Markov chain.</p></li>
<li><p>Generate a trial configuration <span class="math notranslate nohighlight">\(\mathbf{r}_n^N\)</span> according to the
probability <span class="math notranslate nohighlight">\(g(\mathbf{r}_m^N \rightarrow \mathbf{r}^N_n)\)</span>. There
can be many possible ways of generating trial configurations (or
many “moves”), as noted below.</p></li>
<li><p>Calculate the energy difference between the new and old
configurations and calculate the probability of transitioning to the
new state, <span class="math notranslate nohighlight">\(\alpha(\mathbf{r}_m^N \rightarrow \mathbf{r}_n^N)\)</span>
according to Eq. <a class="reference internal" href="#equation-app-a-acceptance">(23)</a>.</p></li>
<li><p>Generate a uniform random number in the range [0, 1]. If the
random number is less than the transition probability, then state
<span class="math notranslate nohighlight">\(i +1\)</span> in the Markov chain has the new configuration
<span class="math notranslate nohighlight">\(\mathbf{r}_n^N\)</span> and the system configuration is updated; that is,
the new trial move is <em>accepted</em>. If the random number is greater
than the transition probability, then state <span class="math notranslate nohighlight">\(i+1\)</span> in the Markov
chain has the old configuration (<span class="math notranslate nohighlight">\(\mathbf{r}_m^N\)</span>), the system
configuration remain the same, and the move is rejected. This step
is the stochastic implementation of Eq.<a class="reference internal" href="#equation-app-a-acceptance">(23)</a>.</p></li>
<li><p>Repeat steps 2-4 until a sufficient number of states in the Markov
chain are generated.</p></li>
<li><p>Approximate the ensemble-average value of some observable
<span class="math notranslate nohighlight">\(Y(\mathbf{r}^N)\)</span> by averaging over all states in the Markov chain.
Note that many states will be repeated, and we include consecutive
identical states (which appear when moves are rejected). Averaging
over all states in the Markov chain then calculates
<span class="math notranslate nohighlight">\(\langle Y(\mathbf{r}^N)\rangle_{NVT}\)</span>.</p></li>
</ol>
<p>Metropolis Monte Carlo has several advantages. First, the acceptance
ratio only relies on the energies of the two states, and as a result the
rule for generating trials moves with a probability given by <span class="math notranslate nohighlight">\(g\)</span> can be
arbitrary and does not have to be physically meaningful. For example,
typical trial moves in a system consisting of a series of liquid-like
particles could be the slight displacement of a single particle, the
rotation of an entire molecule, the displacement of several particles
simultaneously, or non-physical moves such as “hopping” a particle from
one side of the system to the other.</p>
<p>This feature also means that
many-body potentials can be easily used to calculate system energies,
which is more difficult to do in molecular dynamics simulations that
require pair potentials. In addition, because all configurations are
sampled according to their equilibrium probability distributions,
averaging observables over simulation configurations generates ensemble
averages. The downside, however, is that the algorithm is only useful
for calculating equilibrium thermodynamic properties and not observing
system kinetics.</p>
<p>Some care has to be taken in computing ensemble-average quantities. One
choice that can affect values is the starting configuration. If an
initial configuration is generated that is a high energy (and thus
unlikely) state, then it may contribute to a large degree to a resulting
ensemble average even if its actual Boltzmann weight is low. In other
words, imagine a chain with only 10 states; the initial state will
contribute to 1/10 of the ensemble-average even if it should actually
contribute to a much smaller degree. As a result, it is typical to run a
MC algorithm for an initial period of steps that are treated as an
“equilibration” period so that any unphysical, high energy starting
configuration relaxes to a set of low-energy configurations. Inspection
of the MC equations indeed shows that there should generally be a
decrease in the system energy until a set of configurations with similar
low-energy values are obtained.</p>
</section>
<section id="link-to-shared-notes">
<h2><a class="reference external" href="https://docs.google.com/document/d/1p6X8lGLXJ8NCZ4uCPi4ufqxVu1yKsyHf/edit?usp=drive_link&amp;ouid=113272049620170441297&amp;rtpof=true&amp;sd=true">Link to Shared Notes</a><a class="headerlink" href="#link-to-shared-notes" title="Permalink to this headline">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lecture_files"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Lecture10.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Monte Carlo simulations</p>
      </div>
    </a>
    <a class="right-next"
       href="Lecture12A.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Molecular dynamics simulations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-readings-for-the-enthusiast">Additional Readings for the Enthusiast</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-for-today-s-lecture">Goals for Today’s Lecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-sampling">Importance sampling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-chains">Markov chains</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-balance">Detailed balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-hastings-algorithm">The Metropolis-Hastings algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#link-to-shared-notes">Link to Shared Notes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Reid van Lehn, Matt Gebbie, Rose K. Cersonsky
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>